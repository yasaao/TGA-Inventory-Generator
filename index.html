<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Generator: YasTool</title>
    <style>
        :root {
            --primary-color: #D20061; /* Warna Tema Baru */
            --primary-hover: #a3164a; /* Warna Hover Tombol */
            --bg-dark: #0f0f0f;
            --bg-panel: #1e1e1e;
            --text-main: #e0e0e0;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
        }

        /* Scrollbar kustom agar sesuai tema */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #181818; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-color); }

        h1 { 
            margin: 0 0 20px 0; 
            font-size: 1.4rem; 
            color: #fff; 
            text-align: center; 
            letter-spacing: 1px;
            /* Sedikit efek glow pada judul */
            text-shadow: 0 0 15px rgba(210, 0, 97, 0.4); 
        }

        .controls {
            background: var(--bg-panel);
            padding: 20px;
            border-radius: 12px;
            /* Border atas diberi warna tema sebagai aksen */
            border: 1px solid #333;
            border-top: 3px solid var(--primary-color);
            width: 100%;
            max-width: 700px;
            box-sizing: border-box;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
        }

        /* --- LAYOUT BARIS & KOLOM --- */
        .row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: flex-end;
            flex-wrap: wrap;
        }
        
        .col {
            flex: 1;
            min-width: 200px;
            display: flex;
            flex-direction: column;
        }
        
        .col-auto {
            flex: 0 0 50px;
        }

        label {
            font-size: 11px;
            color: #bbb;
            margin-bottom: 6px;
            font-weight: 700;
            text-transform: uppercase;
        }

        /* --- INPUT TEXT & FILE --- */
        input[type="text"], input[type="file"] {
            padding: 8px 10px;
            border: 1px solid #444;
            background: #2c2c2c;
            color: #fff;
            border-radius: 6px;
            font-size: 13px;
            width: 100%;
            box-sizing: border-box;
            transition: all 0.3s;
        }
        /* Fokus input menggunakan warna tema */
        input[type="text"]:focus { 
            border-color: var(--primary-color); 
            box-shadow: 0 0 5px rgba(210, 0, 97, 0.3);
            outline: none; 
        }

        /* --- COLOR PICKER --- */
        input[type="color"] {
            -webkit-appearance: none;
            border: none;
            width: 100%;
            height: 35px;
            border-radius: 6px;
            background: none;
            cursor: pointer;
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: 1px solid #444; border-radius: 6px; }

        /* --- RANGE WRAPPER (Slider + Number) --- */
        .range-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #252525;
            padding: 5px 8px;
            border-radius: 6px;
            border: 1px solid #333;
            transition: border-color 0.3s;
        }
        .range-wrapper:focus-within {
            border-color: #555;
        }

        /* Slider Style */
        input[type="range"] {
            -webkit-appearance: none;
            flex-grow: 1; 
            height: 4px;
            background: #444;
            border-radius: 5px;
            outline: none;
            margin: 0;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            background: var(--primary-color); /* Warna Tema Slider */
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        input[type="range"]::-webkit-slider-thumb:hover { 
            transform: scale(1.2); 
            box-shadow: 0 0 8px var(--primary-color);
        }

        /* Number Input Style (Fixed Size) */
        input[type="number"] {
            width: 50px;
            padding: 2px;
            background: transparent;
            border: none;
            color: var(--primary-color); /* Warna Tema Angka */
            font-weight: bold;
            font-size: 13px;
            text-align: right;
            -moz-appearance: textfield;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"]:focus { outline: none; }


        /* --- BUTTONS --- */
        .toggle-btn {
            background: #333;
            color: #bbb;
            border: none;
            padding: 10px;
            width: 100%;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            text-transform: uppercase;
            font-weight: bold;
            margin-bottom: 15px;
            transition: 0.2s;
        }
        .toggle-btn:hover { background: #444; color: white; }

        #advancedSection {
            display: none;
            background: #181818;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px dashed #444;
        }

        .btn-download {
            width: 100%;
            background-color: var(--primary-color); /* Warna Tema Utama */
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            letter-spacing: 0.5px;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .btn-download:hover { 
            background-color: var(--primary-hover); 
            box-shadow: 0 4px 12px rgba(210, 0, 97, 0.4);
            transform: translateY(-1px);
        }
        .btn-download:active {
            transform: translateY(0);
        }

        /* --- PREVIEW AREA --- */
        .preview-area {
            width: 100%;
            max-width: 1280px; 
            border: 2px solid #333;
            border-radius: 4px;
            background-image: 
                linear-gradient(45deg, #222 25%, transparent 25%), 
                linear-gradient(-45deg, #222 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #222 75%), 
                linear-gradient(-45deg, transparent 75%, #222 75%);
            background-size: 20px 20px;
            background-color: #181818;
            overflow: hidden;
            margin-bottom: 10px;
        }

        canvas {
            display: block;
            width: 100%;
            height: auto;
        }

        .footer-credit {
            font-size: 11px;
            color: #666;
            margin-top: 5px;
            font-weight: 500;
            letter-spacing: 0.5px;
            opacity: 0.7;
        }
        
        /* Utility class untuk teks warna tema */
        .text-theme {
            color: var(--primary-color) !important;
        }
    </style>
</head>
<body>

    <h1>TGA Inventory Generator</h1>

    <div class="controls">
        <!-- 1. Upload -->
        <div class="row">
            <div class="col">
                <label>1. Upload Gambar Senjata (PNG)</label>
                <input type="file" id="imageInput" accept="image/*">
            </div>
        </div>
        
        <!-- 2. Teks & Warna -->
        <div class="row">
             <div class="col">
                <label>2. Nama Skin</label>
                <input type="text" id="textInput" placeholder="Contoh: T77" value="Nama Skin">
            </div>
            <div class="col-auto">
                <label>Warna</label>
                <input type="color" id="textColorInput" value="#ffffff">
            </div>
        </div>

        <!-- 3. Ukuran (Slider + Input Angka) -->
        <div class="row">
            <div class="col">
                <label>Ukuran Teks</label>
                <div class="range-wrapper">
                    <input type="range" id="fontSizeSlider" min="10" max="150" value="60">
                    <input type="number" id="fontSizeNum" value="60" min="10" max="150">
                </div>
            </div>
            <div class="col">
                <label>Ukuran Gambar</label>
                <div class="range-wrapper">
                    <input type="range" id="imgScaleSlider" min="10" max="150" value="100">
                    <input type="number" id="imgScaleNum" value="100" min="10" max="150">
                </div>
            </div>
        </div>

        <!-- 4. Toggle Advanced Settings -->
        <button class="toggle-btn" onclick="toggleAdvanced()">&#9881; Advanced</button>

        <!-- 5. Advanced Settings (Hidden) -->
        <div id="advancedSection">
            <label class="text-theme" style="margin-bottom: 10px; display:block;">Posisi Teks</label>
            <div class="row">
                <div class="col">
                    <label>Horizontal — Kiri / Kanan</label>
                    <div class="range-wrapper">
                        <input type="range" id="textXSlider" min="-600" max="600" value="0">
                        <input type="number" id="textXNum" value="0">
                    </div>
                </div>
                <div class="col">
                    <label>Vertikal — Atas / Bawah</label>
                    <div class="range-wrapper">
                        <input type="range" id="textYSlider" min="-100" max="400" value="0">
                        <input type="number" id="textYNum" value="0">
                    </div>
                </div>
            </div>

            <label class="text-theme" style="margin-bottom: 10px; margin-top: 10px; display:block;">Posisi Gambar</label>
            <div class="row" style="margin-bottom: 0;">
                <div class="col">
                    <label>Horizontal — Kiri / Kanan</label>
                    <div class="range-wrapper">
                        <input type="range" id="imgXSlider" min="-600" max="600" value="0">
                        <input type="number" id="imgXNum" value="0">
                    </div>
                </div>
                <div class="col">
                    <label>Vertikal — Atas / Bawah</label>
                    <div class="range-wrapper">
                        <input type="range" id="imgYSlider" min="-300" max="300" value="0">
                        <input type="number" id="imgYNum" value="0">
                    </div>
                </div>
            </div>
        </div>

        <!-- 6. Output Name & Download -->
        <div class="row">
            <div class="col">
                <label>Nama File Output</label>
                <input type="text" id="filenameInput" placeholder="Contoh = weapon_t77">
            </div>
        </div>

        <button class="btn-download" id="downloadBtn">DOWNLOAD .TGA</button>
    </div>

    <!-- PREVIEW -->
    <div class="preview-area">
        <canvas id="myCanvas" width="1280" height="500"></canvas>
    </div>
    
    <!-- FOOTER CREDIT -->
    <div class="footer-credit">
        @yasaaoursea – Tga inventory generator
    </div>

    <script>
        // --- ELEMENTS ---
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        
        // Inputs Text/File/Color
        const imageInput = document.getElementById('imageInput');
        const textInput = document.getElementById('textInput');
        const textColorInput = document.getElementById('textColorInput');
        const filenameInput = document.getElementById('filenameInput');
        
        // --- INPUT PAIRS (Slider & Number) ---
        const getPair = (idSlider, idNum) => ({
            slider: document.getElementById(idSlider),
            num: document.getElementById(idNum)
        });

        const fontSize = getPair('fontSizeSlider', 'fontSizeNum');
        const imgScale = getPair('imgScaleSlider', 'imgScaleNum');
        const textX = getPair('textXSlider', 'textXNum');
        const textY = getPair('textYSlider', 'textYNum');
        const imgX = getPair('imgXSlider', 'imgXNum');
        const imgY = getPair('imgYSlider', 'imgYNum');

        const allPairs = [fontSize, imgScale, textX, textY, imgX, imgY];

        const downloadBtn = document.getElementById('downloadBtn');
        const advancedSection = document.getElementById('advancedSection');

        let uploadedImage = new Image();
        let isImageLoaded = false;

        // --- TOGGLE FUNCTION ---
        function toggleAdvanced() {
            if (advancedSection.style.display === "block") {
                advancedSection.style.display = "none";
            } else {
                advancedSection.style.display = "block";
            }
        }

        // --- SYNC FUNCTION (Slider <-> Number) ---
        function setupSync(pair) {
            pair.slider.addEventListener('input', () => {
                pair.num.value = pair.slider.value;
                drawCanvas();
            });
            pair.num.addEventListener('input', () => {
                pair.slider.value = pair.num.value;
                drawCanvas();
            });
        }
        allPairs.forEach(pair => setupSync(pair));

        // --- DRAW FUNCTION ---
        function drawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const text = textInput.value;
            const size = fontSize.slider.value;
            const color = textColorInput.value;
            
            const txVal = parseInt(textX.slider.value);
            const tyVal = parseInt(textY.slider.value);
            
            const scalePercent = imgScale.slider.value;
            const userScale = scalePercent / 100;
            const ixVal = parseInt(imgX.slider.value);
            const iyVal = parseInt(imgY.slider.value);

            // DRAW TEXT
            ctx.fillStyle = color; 
            ctx.font = `900 ${size}px Arial`; 
            ctx.textAlign = 'center';     
            ctx.textBaseline = 'top';
            
            const textFinalX = (canvas.width / 2) + txVal;
            const textFinalY = 15 + tyVal;
            
            ctx.fillText(text, textFinalX, textFinalY);

            // DRAW IMAGE
            if (isImageLoaded) {
                const hRatio = canvas.width / uploadedImage.width;
                const vRatio = canvas.height / uploadedImage.height;
                const baseRatio = Math.min(hRatio, vRatio);
                const finalRatio = baseRatio * userScale;

                const imgWidth = uploadedImage.width * finalRatio;
                const imgHeight = uploadedImage.height * finalRatio;

                const centerX = (canvas.width - imgWidth) / 2;
                const centerY = (canvas.height - imgHeight) / 2;

                const imgFinalX = centerX + ixVal;
                const imgFinalY = centerY + iyVal;

                ctx.drawImage(uploadedImage, 0, 0, uploadedImage.width, uploadedImage.height,
                              imgFinalX, imgFinalY, imgWidth, imgHeight);
            }
        }

        // --- EVENT LISTENERS ---
        textInput.addEventListener('input', drawCanvas);
        textColorInput.addEventListener('input', drawCanvas);

        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    uploadedImage.src = event.target.result;
                    uploadedImage.onload = function() {
                        isImageLoaded = true;
                        drawCanvas();
                    }
                }
                reader.readAsDataURL(file);
            }
        });

        // --- DOWNLOAD LOGIC ---
        downloadBtn.addEventListener('click', function() {
            const width = canvas.width;
            const height = canvas.height;
            const imageData = ctx.getImageData(0, 0, width, height);
            const data = imageData.data;

            const header = new Uint8Array(18);
            header[2] = 2;   
            header[12] = width & 0xFF;
            header[13] = (width >> 8) & 0xFF;
            header[14] = height & 0xFF;
            header[15] = (height >> 8) & 0xFF;
            header[16] = 32; 
            header[17] = 0x28; 

            const bufferSize = 18 + (width * height * 4);
            const tgaBuffer = new Uint8Array(bufferSize);
            tgaBuffer.set(header, 0);

            let offset = 18;
            for (let i = 0; i < data.length; i += 4) {
                tgaBuffer[offset++] = data[i + 2]; 
                tgaBuffer[offset++] = data[i + 1]; 
                tgaBuffer[offset++] = data[i];     
                tgaBuffer[offset++] = data[i + 3]; 
            }

            const customName = filenameInput.value.trim();
            const itemLabel = textInput.value.trim();
            let rawName = customName.length > 0 ? customName : itemLabel;
            if (rawName.length === 0) rawName = "inventory_item"; 
            let safeName = rawName.replace(/[^a-zA-Z0-9-_ ]/g, '').replace(/\s+/g, '_');

            const blob = new Blob([tgaBuffer], { type: 'image/x-tga' });
            const link = document.createElement('a');
            link.download = safeName + '.tga';
            link.href = URL.createObjectURL(blob);
            link.click();
        });

        drawCanvas();
    </script>
</body>
</html>